(()=>{"use strict";var t={138:(t,a,e)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.LabToXYZ=a.XYZToLab=a.XYZToRGB=a.RGBToXYZ=a.LabToColor=a.ColorToLab=a.I3DXAlphaBlend=a.ARGB=a.XRGB=void 0;const r=e(555);function o(t,a,e){return{a:255,r:t,g:a,b:e}}function n(t,a,e){let r=t/255,o=a/255,n=e/255;return r>.04045?r=Math.pow((r+.055)/1.055,2.4):r/=12.92,r*=100,o>.04045?o=Math.pow((o+.055)/1.055,2.4):o/=12.92,o*=100,n>.04045?n=Math.pow((n+.055)/1.055,2.4):n/=12.92,n*=100,[.4124*r+.3576*o+.1805*n,.2126*r+.7152*o+.0722*n,.0193*r+.1192*o+.9505*n]}function i(t,a,e){const r=t/100,o=a/100,n=e/100;let i=3.2406*r+-1.5372*o+-.4986*n,s=-.9689*r+1.8758*o+.0415*n,d=.0557*r+-.204*o+1.057*n;return Math.abs(i)>.0031308?i=1.055*Math.pow(i,1/2.4)-.055:i*=12.92,Math.abs(s)>.0031308?s=1.055*Math.pow(s,1/2.4)-.055:s*=12.92,Math.abs(d)>.0031308?d=1.055*Math.pow(d,1/2.4)-.055:d*=12.92,[Math.min(Math.max(Math.round(255*i),0),255),Math.min(Math.max(Math.round(255*s),0),255),Math.min(Math.max(Math.round(255*d),0),255)]}a.XRGB=o,a.ARGB=function(t,a,e,r){return{a:t,r:a,g:e,b:r}},a.I3DXAlphaBlend=function(t,a){let{a:e,r:o,g:n,b:i}=r.unpack(t),{a:s,r:d,g:I,b:c}=r.unpack(a);if(0===s)return t;if(0===e)return a;e/=255,s/=255;let D=s+e*(1-s);const h=Math.round((d*s+o*e*(1-s))/D),u=Math.round((I*s+n*e*(1-s))/D),l=Math.round((c*s+i*e*(1-s))/D);return D=Math.min(255,Math.round(255*D)),r.pack(D,h,u,l)},a.ColorToLab=function(t){const{r:a,g:e,b:r}=t,[o,i,s]=n(a,e,r);return I(o,i,s)},a.LabToColor=function(t,a,e){const[r,n,s]=c(t,a,e),[d,I,D]=i(r,n,s);return o(d,I,D)},a.RGBToXYZ=n,a.XYZToRGB=i;const s=95.047,d=108.883;function I(t,a,e){let r=t/s,o=a/100,n=e/d;return r=r>.008856?Math.pow(r,1/3):7.787*r+16/116,o=o>.008856?Math.pow(o,1/3):7.787*o+16/116,n=n>.008856?Math.pow(n,1/3):7.787*n+16/116,[116*o-16,500*(r-o),200*(o-n)]}function c(t,a,e){let r=(t+16)/116,o=a/500+r,n=r-e/200;return o=Math.pow(o,3)>.008856?Math.pow(o,3):(o-16/116)/7.787,r=Math.pow(r,3)>.008856?Math.pow(r,3):(r-16/116)/7.787,n=Math.pow(n,3)>.008856?Math.pow(n,3):(n-16/116)/7.787,[o*s,100*r,n*d]}a.XYZToLab=I,a.LabToXYZ=c},210:(t,a,e)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.I3DXDevice=a.I3DPT_TRIANGLEFAN=a.I3DPT_TRIANGLESTRIP=a.I3DPT_TRIANGLELIST=a.I3DPT_LINESTRIP=a.I3DPT_LINELIST=a.I3DPT_POINTLIST=a.I3DTS_PROJECTION=a.I3DTS_VIEW=a.I3DTS_WORLD=void 0;const r=e(555),o=e(138),n=e(31),i=e(573),s=e(49);o.XRGB(255,255,255),a.I3DTS_WORLD="world",a.I3DTS_VIEW="view",a.I3DTS_PROJECTION="projection",a.I3DPT_POINTLIST=1,a.I3DPT_LINELIST=2,a.I3DPT_LINESTRIP=3,a.I3DPT_TRIANGLELIST=4,a.I3DPT_TRIANGLESTRIP=5,a.I3DPT_TRIANGLEFAN=6,a.I3DXDevice=class{constructor(t,e,r){this._ambientLight={r:0,g:0,b:0,a:0},this._lights=[],this.WIDTH=e,this.HWIDTH=e/2,this.HEIGHT=r,this.HHEIGHT=r/2,this._canvas=document.createElement("canvas"),this._canvas.width=e,this._canvas.height=r,t.appendChild(this._canvas),this._ctx=this._canvas.getContext("2d"),this._backBuffer=this._ctx.createImageData(e,r);const o=i.I3DXMatrixLookAtLH(n.I3DXVector3(0,0,10),n.I3DXVector3(0,0,0),n.I3DXVector3(0,1,0)),s=i.I3DXMatrixPerspectiveFovLH(n.I3DXToRadian(45),e/r,1,100);this._transforms={[a.I3DTS_WORLD]:n.I3DXMatrixIdentity(4),[a.I3DTS_VIEW]:o,[a.I3DTS_PROJECTION]:s};const d=this.WIDTH*this.HEIGHT;this._zbufferData=new Int32Array(d),this._zbufferDepth=new Float32Array(d)}SetAmbientLight(t){this._ambientLight=t}SetLight(t,a){this._lights[t]=a}GetLight(t){return this._lights[t]}SetTransform(t,a){this._transforms[t]=a}MultiplyTransform(t,a){this._transforms[t]=n.I3DXMatrixMultiply(a,this._transforms[t])}BeginScene(){this.ZBufferClear(),this._backBuffer=this._ctx.createImageData(this.WIDTH,this.HEIGHT)}DrawPrimitive(t,e){const d=n.I3DXMatrixMultiply(this._transforms[a.I3DTS_VIEW],this._transforms[a.I3DTS_WORLD]),I=n.I3DXMatrixMultiply(this._transforms[a.I3DTS_PROJECTION],d),c=n.I3DXVector3(0,0,1),D=this._lights.filter((t=>t.type===s.I3DLightType.Point)).map((t=>({light:t,pos:n.I3DXMatrixMultiply(this._transforms[a.I3DTS_VIEW],t.position)})));switch(t){case a.I3DPT_POINTLIST:for(let t=0;t<e.length;t++){const a=n.I3DXMatrixMultiply(I,e[t].coordinates),o=a.data[0]/a.data[3],i=a.data[1]/a.data[3],s=a.data[2]/a.data[3];if(Math.abs(o)<=1&&Math.abs(i)<=1&&Math.abs(s)<=1){const a=Math.round((1-o)*this.HWIDTH),n=Math.round((1-i)*this.HHEIGHT);let{a:d,r:I,g:c,b:D}=e[t].color;I*=this._ambientLight.r,c*=this._ambientLight.g,D*=this._ambientLight.b,this.ZBufferSet(a,n,r.pack(d,I,c,D),s)}}break;case a.I3DPT_LINELIST:case a.I3DPT_LINESTRIP:for(let o=0;o<e.length-1;o++){const i=e[o],s=e[o+1],d=n.I3DXMatrixMultiply(I,i.coordinates),c=n.I3DXMatrixMultiply(I,s.coordinates),D=d.data[0]/d.data[3],h=d.data[1]/d.data[3],u=d.data[2]/d.data[3],l=c.data[0]/c.data[3],X=c.data[1]/c.data[3],M=c.data[2]/c.data[3],{a:f,r:T,g:x,b}=e[o].color,{a:m,r:w,g,b:_}=e[o+1].color,V=m-f,L=w-T,p=g-x,S=_-b,R=t=>r.pack(Math.round(V*t+f),Math.round(L*t+T),Math.round(p*t+x),Math.round(S*t+b)),y=l-D,v=X-h,A=M-u,P=t=>[y*t+D,v*t+h,A*t+u],E=Math.round((1-D)*this.HWIDTH),H=Math.round((1-l)*this.HWIDTH),N=Math.abs(H-E);for(let t=0;t<=N;t++){const a=t/N,[e,r,o]=P(a),n=R(a);if(Math.abs(e)<1&&Math.abs(r)<1&&Math.abs(o)<1){const t=Math.round((1-e)*this.HWIDTH),a=Math.round((1-r)*this.HHEIGHT);this.ZBufferSet(t,a,n,o)}}t===a.I3DPT_LINELIST&&o++}break;case a.I3DPT_TRIANGLELIST:case a.I3DPT_TRIANGLESTRIP:case a.I3DPT_TRIANGLEFAN:for(let s=0;s<e.length-2;){let I,h,u;t===a.I3DPT_TRIANGLELIST?(I=s,h=s+1,u=s+2,s+=3):t===a.I3DPT_TRIANGLESTRIP?(I=s,h=s+1,u=s+2,s%2==1&&([h,u]=[u,h]),s++):(I=0,h=s+1,u=s+2,s++);const l=n.I3DXMatrixMultiply(d,e[I].coordinates),X=n.I3DXMatrixMultiply(d,e[h].coordinates),M=n.I3DXMatrixMultiply(d,e[u].coordinates),f=n.I3DXVectorUnit(n.I3DXVectorCross(n.I3DXMatrixSubtract(X,l),n.I3DXMatrixSubtract(M,l))),T=e[I].color,x=e[h].color,b=e[u].color,m=n.I3DXMatrixMultiply(this._transforms[a.I3DTS_PROJECTION],l),w=n.I3DXMatrixMultiply(this._transforms[a.I3DTS_PROJECTION],X),g=n.I3DXMatrixMultiply(this._transforms[a.I3DTS_PROJECTION],M),_=n.I3DXVector3(m.data[0]/m.data[3],m.data[1]/m.data[3],m.data[2]/m.data[3]),V=n.I3DXVector3(w.data[0]/w.data[3],w.data[1]/w.data[3],w.data[2]/w.data[3]),L=n.I3DXVector3(g.data[0]/g.data[3],g.data[1]/g.data[3],g.data[2]/g.data[3]),p=n.I3DXMatrixSubtract(V,_),S=n.I3DXMatrixSubtract(L,_),R=n.I3DXMatrixSubtract(L,V),y=n.I3DXMatrixSubtract(_,L),v=n.I3DXVectorUnit(n.I3DXVectorCross(p,S)),A=n.I3DXVectorDot(c,_),P=n.I3DXVectorDot(v,c);if(P<=0)continue;const E=Math.round((1-_.data[0])*this.HWIDTH),H=Math.round((1-_.data[1])*this.HHEIGHT),N=Math.round((1-V.data[0])*this.HWIDTH),B=Math.round((1-V.data[1])*this.HHEIGHT),G=Math.round((1-L.data[0])*this.HWIDTH),O=Math.round((1-L.data[1])*this.HHEIGHT),W=Math.max(Math.min(H,B,O),0),C=Math.min(Math.max(H,B,O),this.HEIGHT),k=Math.max(Math.min(E,N,G),0),z=Math.min(Math.max(E,N,G),this.WIDTH),F=T.a,Z=x.a,Y=b.a,K={r:T.r/255,g:T.g/255,b:T.b/255},j={r:x.r/255,g:x.g/255,b:x.b/255},q={r:b.r/255,g:b.g/255,b:b.b/255},$={a:F,r:K.r*this._ambientLight.r,g:K.g*this._ambientLight.g,b:K.b*this._ambientLight.b},J={a:Z,r:j.r*this._ambientLight.r,g:j.g*this._ambientLight.g,b:j.b*this._ambientLight.b},U={a:Y,r:q.r*this._ambientLight.r,g:q.g*this._ambientLight.g,b:q.b*this._ambientLight.b};for(let t of D){let a=n.I3DXMatrixSubtract(l,t.pos);const e=n.I3DXVectorLength(a);a=n.I3DXMatrixScale(a,1/e);const r=Math.max(n.I3DXVectorDot(n.I3DXVector3(a.data[0],a.data[1],a.data[2]),f),0),o=t.light.atten0+t.light.atten1*e+t.light.atten2*e*e;$.r+=K.r*t.light.diffuse.r*r*1/o,$.g+=K.g*t.light.diffuse.g*r*1/o,$.b+=K.b*t.light.diffuse.b*r*1/o;let i=n.I3DXMatrixSubtract(X,t.pos);const s=n.I3DXVectorLength(i);i=n.I3DXMatrixScale(i,1/s);const d=Math.max(n.I3DXVectorDot(n.I3DXVector3(i.data[0],i.data[1],i.data[2]),f),0),I=t.light.atten0+t.light.atten1*s+t.light.atten2*s*s;J.r+=j.r*t.light.diffuse.r*d*1/I,J.g+=j.g*t.light.diffuse.g*d*1/I,J.b+=j.b*t.light.diffuse.b*d*1/I;let c=n.I3DXMatrixSubtract(M,t.pos);const D=n.I3DXVectorLength(c);c=n.I3DXMatrixScale(c,1/D);const h=Math.max(n.I3DXVectorDot(n.I3DXVector3(c.data[0],c.data[1],c.data[2]),f),0),u=t.light.atten0+t.light.atten1*D+t.light.atten2*D*D;U.r+=q.r*t.light.diffuse.r*h*1/u,U.g+=q.g*t.light.diffuse.g*h*1/u,U.b+=q.b*t.light.diffuse.b*h*1/u}$.r=255*Math.min($.r,1),$.g=255*Math.min($.g,1),$.b=255*Math.min($.b,1),J.r=255*Math.min(J.r,1),J.g=255*Math.min(J.g,1),J.b=255*Math.min(J.b,1),U.r=255*Math.min(U.r,1),U.g=255*Math.min(U.g,1),U.b=255*Math.min(U.b,1);const Q=o.ColorToLab($),tt=o.ColorToLab(J),at=o.ColorToLab(U);for(let t=W;t<=C;t++)for(let a=k;a<=z;a++){const e=1-a/this.HWIDTH,s=1-t/this.HHEIGHT,d=n.I3DXVector3(e,s,0),I=(A-n.I3DXVectorDot(v,d))/P,c=n.I3DXVector3(e,s,I);if(!(n.I3DXVectorDot(n.I3DXVectorCross(p,n.I3DXMatrixSubtract(c,_)),v)>=0&&n.I3DXVectorDot(n.I3DXVectorCross(R,n.I3DXMatrixSubtract(c,V)),v)>=0&&n.I3DXVectorDot(n.I3DXVectorCross(y,n.I3DXMatrixSubtract(c,L)),v)>=0))continue;const[D,h,u]=i.I3DXBarycentricCoords(e,s,_.x,_.y,V.x,V.y,L.x,L.y),l=Q[0]*D+tt[0]*h+at[0]*u,X=Q[1]*D+tt[1]*h+at[1]*u,M=Q[2]*D+tt[2]*h+at[2]*u,{r:f,g:T,b:x}=o.LabToColor(l,X,M),b=r.pack(Math.round(F*D+Z*h+Y*u),f,T,x);this.ZBufferSet(a,t,b,I)}}}}EndScene(){const t=this.WIDTH*this.HEIGHT*4;for(let a=0;a<t;){const{a:t,r:e,g:o,b:n}=r.unpack(this._zbufferData[a/4]);this._backBuffer.data[a++]=e,this._backBuffer.data[a++]=o,this._backBuffer.data[a++]=n,this._backBuffer.data[a++]=t}}Present(){this._ctx.putImageData(this._backBuffer,0,0)}ZBufferSet(t,a,e,n){const i=this.WIDTH*(a-1)+t,s=this._zbufferDepth[i],d=this._zbufferData[i],{a:I}=r.unpack(d);if(I>=255&&s<n)return;const{a:c}=r.unpack(e);if(c>=255&&n<s||0===I)return this._zbufferData[i]=e,void(this._zbufferDepth[i]=n);this._zbufferData[i]=n>s?o.I3DXAlphaBlend(e,d):o.I3DXAlphaBlend(d,e),n<s&&(this._zbufferDepth[i]=n)}ZBufferClear(){const t=this.WIDTH*this.HEIGHT;this._zbufferData=new Int32Array(t),this._zbufferDepth=new Float32Array(t)}}},573:(t,a,e)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.I3DXBarycentricCoords=a.I3DXMatrixOrthoLH=a.I3DXMatrixPerspectiveFovLH=a.I3DXMatrixLookToLH=a.I3DXMatrixLookAtLH=a.I3DXVertex=void 0;const r=e(31);function o(t,a,e){const o=r.I3DXVectorUnit(r.I3DXMatrixSubtract(a,t)),n=r.I3DXVectorUnit(r.I3DXVectorCross(e,o)),i=r.I3DXVectorCross(o,n),s=r.I3DXVectorDot(n,t),d=r.I3DXVectorDot(i,t),I=r.I3DXVectorDot(o,t);return new r.I3DXMatrix(4,4,[n.data[0],n.data[1],n.data[2],-s,i.data[0],i.data[1],i.data[2],-d,o.data[0],o.data[1],o.data[2],-I,0,0,0,1])}a.I3DXVertex=class{constructor(t,a,e,o){const n=r.I3DXVector(4,[t,a,e,1]);this.coordinates=n,this.color=o}},a.I3DXMatrixLookAtLH=o,a.I3DXMatrixLookToLH=function(t,a,e){return o(t,r.I3DXMatrixAdd(t,a),e)},a.I3DXMatrixPerspectiveFovLH=function(t,a,e,o){const n=1/Math.tan(t/2),i=n/a,s=o/(o-e);return new r.I3DXMatrix(4,4,[i,0,0,0,0,n,0,0,0,0,s,-e*s,0,0,1,0])},a.I3DXMatrixOrthoLH=function(t,a,e,o){const n=o-e;return new r.I3DXMatrix(4,4,[2/t,0,0,0,0,2/a,0,0,0,0,1/n,-e/n,0,0,0,1])},a.I3DXBarycentricCoords=function(t,a,e,r,o,n,i,s){const d=n-s,I=i-o,c=e-i,D=t-i,h=a-s,u=d*c+I*(r-s),l=(d*D+I*h)/u,X=((s-r)*D+c*h)/u;return[l,X,1-l-X]}},148:function(t,a,e){var r=this&&this.__createBinding||(Object.create?function(t,a,e,r){void 0===r&&(r=e),Object.defineProperty(t,r,{enumerable:!0,get:function(){return a[e]}})}:function(t,a,e,r){void 0===r&&(r=e),t[r]=a[e]}),o=this&&this.__exportStar||function(t,a){for(var e in t)"default"===e||Object.prototype.hasOwnProperty.call(a,e)||r(a,t,e)};Object.defineProperty(a,"__esModule",{value:!0}),o(e(138),a),o(e(210),a),o(e(573),a),o(e(31),a)},49:(t,a)=>{var e;Object.defineProperty(a,"__esModule",{value:!0}),a.I3DLight=a.I3DLightType=void 0,(e=a.I3DLightType||(a.I3DLightType={}))[e.Point=1]="Point",e[e.Spot=2]="Spot",e[e.Directional=3]="Directional",a.I3DLight=class{constructor(t){this.atten0=1,this.atten1=0,this.atten2=0,this.type=t}}},31:(t,a)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.I3DXVectorUnit=a.I3DXVectorLength=a.I3DXVectorDot=a.I3DXVectorCross=a.I3DXVector3=a.I3DXVector=a.I3DXVec=a.I3DXMatrixScale=a.I3DXMatrixSubtract=a.I3DXMatrixAdd=a.I3DXMatrixMultiply=a.I3DXMatrixTranspose=a.I3DXRotateZMatrix=a.I3DXRotateYMatrix=a.I3DXRotateXMatrix=a.I3DXToRadian=a.I3DXScaleMatrix=a.I3DXTranslateMatrix=a.I3DXMatrixIdentity=a.I3DXMatrix=void 0;class e{constructor(t,a,e){if(void 0===a&&(a=t),this.rows=t,this.cols=a,e){if(e.length!==t*a)throw new Error("data does not match matrix dimension");this.data=Float32Array.from(e)}else this.data=new Float32Array(t*a)}_idx(t,a){return t*this.cols+a}get(t,a){return this.data[this._idx(t,a)]}set(t,a,e){this.data[this._idx(t,a)]=e}incr(t,a,e){this.data[this._idx(t,a)]+=e}debug(){const t=[];for(let a=0;a<this.rows;a++){t.push([]);for(let e=0;e<this.cols;e++)t[a].push(this.get(a,e))}console.table(t)}}function r(t){const a=new e(t,t);for(let e=0;e<t;e++)a.set(e,e,1);return a}function o(t,a){const r=new e(t.rows,t.cols),o=t.rows*t.cols;for(let e=0;e<o;e++)r.data[e]=t.data[e]*a;return r}a.I3DXMatrix=e,a.I3DXMatrixIdentity=r,a.I3DXTranslateMatrix=function(t,a,e){const o=r(4);return o.set(0,3,t),o.set(1,3,a),o.set(2,3,e),o},a.I3DXScaleMatrix=function(t,a,e){const o=r(4);return o.set(0,0,t),o.set(1,1,a),o.set(2,2,e),o},a.I3DXToRadian=function(t){return t/180*Math.PI},a.I3DXRotateXMatrix=function(t){const a=r(4),e=Math.cos(t),o=Math.sin(t);return a.set(1,1,e),a.set(1,2,-o),a.set(2,1,o),a.set(2,2,e),a},a.I3DXRotateYMatrix=function(t){const a=r(4),e=Math.cos(t),o=Math.sin(t);return a.set(0,0,e),a.set(0,2,o),a.set(2,0,-o),a.set(2,2,e),a},a.I3DXRotateZMatrix=function(t){const a=r(4),e=Math.cos(t),o=Math.sin(t);return a.set(0,0,e),a.set(0,1,-o),a.set(1,0,o),a.set(1,1,e),a},a.I3DXMatrixTranspose=function(t){const a=new e(t.cols,t.rows);for(let e=0;e<t.rows;e++)for(let r=0;r<t.cols;r++)a.set(r,e,t.get(e,r));return a},a.I3DXMatrixMultiply=function(t,a){if(t.cols!==a.rows){const e=`(${t.rows},${t.cols})`,r=`(${a.rows},${a.cols})`;throw new Error(`Matrices must be multiplicable! ${e}:${r}`)}const r=new e(t.rows,a.cols);if(3===t.rows&&3===t.cols&&3===a.rows&&3===a.cols)r.data[0]=t.data[0]*a.data[0]+t.data[1]*a.data[3]+t.data[2]*a.data[6],r.data[1]=t.data[0]*a.data[1]+t.data[1]*a.data[4]+t.data[2]*a.data[7],r.data[2]=t.data[0]*a.data[2]+t.data[1]*a.data[5]+t.data[2]*a.data[8],r.data[3]=t.data[3]*a.data[0]+t.data[4]*a.data[3]+t.data[5]*a.data[6],r.data[4]=t.data[3]*a.data[1]+t.data[4]*a.data[4]+t.data[5]*a.data[7],r.data[5]=t.data[3]*a.data[2]+t.data[4]*a.data[5]+t.data[5]*a.data[8],r.data[6]=t.data[6]*a.data[0]+t.data[7]*a.data[3]+t.data[8]*a.data[6],r.data[7]=t.data[6]*a.data[1]+t.data[7]*a.data[4]+t.data[8]*a.data[7],r.data[8]=t.data[6]*a.data[2]+t.data[7]*a.data[5]+t.data[8]*a.data[8];else if(4===t.rows&&4===t.cols&&4===a.rows&&4===a.cols)r.data[0]=t.data[0]*a.data[0]+t.data[1]*a.data[4]+t.data[2]*a.data[8]+t.data[3]*a.data[12],r.data[1]=t.data[0]*a.data[1]+t.data[1]*a.data[5]+t.data[2]*a.data[9]+t.data[3]*a.data[13],r.data[2]=t.data[0]*a.data[2]+t.data[1]*a.data[6]+t.data[2]*a.data[10]+t.data[3]*a.data[14],r.data[3]=t.data[0]*a.data[3]+t.data[1]*a.data[7]+t.data[2]*a.data[11]+t.data[3]*a.data[15],r.data[4]=t.data[4]*a.data[0]+t.data[5]*a.data[4]+t.data[6]*a.data[8]+t.data[7]*a.data[12],r.data[5]=t.data[4]*a.data[1]+t.data[5]*a.data[5]+t.data[6]*a.data[9]+t.data[7]*a.data[13],r.data[6]=t.data[4]*a.data[2]+t.data[5]*a.data[6]+t.data[6]*a.data[10]+t.data[7]*a.data[14],r.data[7]=t.data[4]*a.data[3]+t.data[5]*a.data[7]+t.data[6]*a.data[11]+t.data[7]*a.data[15],r.data[8]=t.data[8]*a.data[0]+t.data[9]*a.data[4]+t.data[10]*a.data[8]+t.data[11]*a.data[12],r.data[9]=t.data[8]*a.data[1]+t.data[9]*a.data[5]+t.data[10]*a.data[9]+t.data[11]*a.data[13],r.data[10]=t.data[8]*a.data[2]+t.data[9]*a.data[6]+t.data[10]*a.data[10]+t.data[11]*a.data[14],r.data[11]=t.data[8]*a.data[3]+t.data[9]*a.data[7]+t.data[10]*a.data[11]+t.data[11]*a.data[15],r.data[12]=t.data[12]*a.data[0]+t.data[13]*a.data[4]+t.data[14]*a.data[8]+t.data[15]*a.data[12],r.data[13]=t.data[12]*a.data[1]+t.data[13]*a.data[5]+t.data[14]*a.data[9]+t.data[15]*a.data[13],r.data[14]=t.data[12]*a.data[2]+t.data[13]*a.data[6]+t.data[14]*a.data[10]+t.data[15]*a.data[14],r.data[15]=t.data[12]*a.data[3]+t.data[13]*a.data[7]+t.data[14]*a.data[11]+t.data[15]*a.data[15];else for(let e=0;e<t.rows;e++)for(let o=0;o<a.cols;o++){let n=0;for(let r=0;r<t.cols;r++)n+=t.get(e,r)*a.get(r,o);r.set(e,o,n)}return r},a.I3DXMatrixAdd=function(t,a){if(t.rows!==a.rows||t.cols!==a.cols)throw new Error("Matrices must be the same size!");const r=new e(t.rows,t.cols),o=t.rows*t.cols;for(let e=0;e<o;e++)r.data[e]=t.data[e]+a.data[e];return r},a.I3DXMatrixSubtract=function(t,a){if(t.rows!==a.rows||t.cols!==a.cols)throw new Error("Matrices must be the same size!");const r=new e(t.rows,t.cols),o=t.rows*t.cols;for(let e=0;e<o;e++)r.data[e]=t.data[e]-a.data[e];return r},a.I3DXMatrixScale=o;class n extends e{constructor(t,a,e){super(t,a,e)}get x(){return this.data[0]}set x(t){this.data[0]=t}get y(){return this.data[1]}set y(t){this.data[1]=t}get z(){return this.data[2]}set z(t){this.data[2]=t}get w(){return this.data[3]}set w(t){this.data[3]=t}toVec3(){return s(this.x,this.y,this.z)}}function i(t,a){return new n(t,1,a)}function s(t,a,e){return i(3,[t,a,e])}function d(t,a){if(t.rows!==a.rows||t.cols!==a.cols)throw new Error(`Vectors must be the same size! (${t.rows}x${t.cols}) vs (${a.rows}x${a.cols})`);let e=0;const r=t.rows*t.cols;for(let o=0;o<r;o++)e+=t.data[o]*a.data[o];return e}function I(t){return Math.sqrt(d(t,t))}a.I3DXVec=n,a.I3DXVector=i,a.I3DXVector3=s,a.I3DXVectorCross=function(t,a){const e=i(3);return e.x=t.data[1]*a.data[2]-t.data[2]*a.data[1],e.y=t.data[2]*a.data[0]-t.data[0]*a.data[2],e.z=t.data[0]*a.data[1]-t.data[1]*a.data[0],e},a.I3DXVectorDot=d,a.I3DXVectorLength=I,a.I3DXVectorUnit=function(t){return o(t,1/I(t))}},555:(t,a)=>{function e(t,a,e){return Math.max(Math.min(t,e),a)}Object.defineProperty(a,"__esModule",{value:!0}),a.sqr=a.unpack=a.pack=a.clamp=void 0,a.clamp=e,a.pack=function(t,a,r,o){return e(t,0,255)<<24|e(a,0,255)<<16|e(r,0,255)<<8|e(o,0,255)},a.unpack=function(t){return{a:(4278190080&t)>>>24,r:(16711680&t)>>>16,g:(65280&t)>>>8,b:255&t}},a.sqr=function(t){return t*t}}},a={};function e(r){var o=a[r];if(void 0!==o)return o.exports;var n=a[r]={exports:{}};return t[r].call(n.exports,n,n.exports,e),n.exports}(()=>{const t=e(148),a=e(49);!function(){const e=document.getElementById("indirect-container"),r=document.getElementById("camera-x"),o=document.getElementById("camera-y"),n=document.getElementById("camera-z"),i=document.getElementById("direction-x"),s=document.getElementById("direction-y"),d=document.getElementById("direction-z"),I=document.getElementById("fovy"),c=document.getElementById("fps"),D=document.getElementById("red-depth-input"),h=document.getElementById("blue-depth-input"),u=[new t.I3DXVertex(-2.5,-3,0,t.ARGB(255,255,0,0)),new t.I3DXVertex(0,3,0,t.ARGB(255,0,255,0)),new t.I3DXVertex(2.5,-3,0,t.ARGB(255,0,0,255))],l=[new t.I3DXVertex(0,1,0,t.XRGB(255,255,255)),new t.I3DXVertex(-1,0,0,t.XRGB(255,64,64)),new t.I3DXVertex(0,0,-1,t.XRGB(255,255,64)),new t.I3DXVertex(1,0,0,t.XRGB(64,64,255)),new t.I3DXVertex(0,0,1,t.XRGB(64,255,64)),new t.I3DXVertex(-1,0,0,t.XRGB(255,64,64))],X=t.ARGB(255,255,255,255),M=t.ARGB(255,255,255,255),f=Math.sqrt(2)/2,T=Math.sqrt(2-Math.sqrt(2))/2,x=Math.sqrt(2+Math.sqrt(2))/2,b=[new t.I3DXVertex(1,1,0,X),new t.I3DXVertex(x,0,T,M),new t.I3DXVertex(f,1,f,X),new t.I3DXVertex(T,0,x,M),new t.I3DXVertex(0,1,1,X),new t.I3DXVertex(-T,0,x,M),new t.I3DXVertex(-f,1,f,X),new t.I3DXVertex(-x,0,T,M),new t.I3DXVertex(-1,1,0,X),new t.I3DXVertex(-x,0,-T,M),new t.I3DXVertex(-f,1,-f,X),new t.I3DXVertex(-T,0,-x,M),new t.I3DXVertex(0,1,-1,X),new t.I3DXVertex(T,0,-x,M),new t.I3DXVertex(f,1,-f,X),new t.I3DXVertex(x,0,-T,M),new t.I3DXVertex(1,1,0,X),new t.I3DXVertex(x,0,T,M),new t.I3DXVertex(f,1,f,X),new t.I3DXVertex(x,0,T,M),new t.I3DXVertex(1,1,0,X),new t.I3DXVertex(x,0,-T,M),new t.I3DXVertex(f,1,-f,X),new t.I3DXVertex(T,0,-x,M),new t.I3DXVertex(0,1,-1,X),new t.I3DXVertex(-T,0,-x,M),new t.I3DXVertex(-f,1,-f,X),new t.I3DXVertex(-x,0,-T,M),new t.I3DXVertex(-1,1,0,X),new t.I3DXVertex(-x,0,T,M),new t.I3DXVertex(-f,1,f,X),new t.I3DXVertex(-T,0,x,M),new t.I3DXVertex(0,1,1,X),new t.I3DXVertex(T,0,x,M),new t.I3DXVertex(f,1,f,X),new t.I3DXVertex(x,0,T,M),new t.I3DXVertex(1,1,0,X)],m=t.I3DXMatrixMultiply(t.I3DXScaleMatrix(2,1,2),t.I3DXTranslateMatrix(0,-.5,0)),w=t.I3DXMatrixIdentity(4),g=t.I3DXVector3(0,1,0),_=[new t.I3DXVertex(0,0,0,t.ARGB(128,0,0,255)),new t.I3DXVertex(1,1,0,t.ARGB(128,0,0,255)),new t.I3DXVertex(2,0,0,t.ARGB(128,0,0,255))],V=[new t.I3DXVertex(0,0,0,t.XRGB(255,0,0)),new t.I3DXVertex(1,1,0,t.XRGB(255,0,0)),new t.I3DXVertex(2,0,0,t.XRGB(255,0,0))];let L=t.I3DXVector(4,[0,0,-1,0]);const p=t.I3DXMatrixLookToLH(t.I3DXVector3(r.valueAsNumber,o.valueAsNumber,n.valueAsNumber),t.I3DXVector3(L.data[0],L.data[1],L.data[2]),g),S=t.I3DXMatrixPerspectiveFovLH(t.I3DXToRadian(I.valueAsNumber),640/480,1,100),R=new t.I3DXDevice(e,640,480);R.SetAmbientLight(t.XRGB(.1,.1,.1)),R.SetTransform(t.I3DTS_VIEW,p),R.SetTransform(t.I3DTS_PROJECTION,S),R.SetTransform(t.I3DTS_WORLD,w);const y=new a.I3DLight(a.I3DLightType.Point);y.diffuse={a:0,r:.15,g:0,b:.5},y.position=t.I3DXVector(4,[-8,5,15,1]),y.atten0=0,y.atten1=.01,y.atten2=.001,R.SetLight(0,y);const v=new a.I3DLight(a.I3DLightType.Point);v.diffuse={a:0,r:.5,g:.7,b:.2},v.position=t.I3DXVector(4,[1,3,-15,1]),v.atten0=0,v.atten1=.1,v.atten2=.001,R.SetLight(1,v);let A,P=0,E=!1,H=0;const N={KeyW:!1,KeyQ:!1,KeyE:!1,KeyS:!1,KeyA:!1,KeyD:!1};function B(){let a=Date.now();const e=a-A;if(R.BeginScene(),L=t.I3DXVectorUnit(t.I3DXVector(4,[i.valueAsNumber,s.valueAsNumber,d.valueAsNumber,1])),N.KeyA){const a=t.I3DXRotateYMatrix(.005*e);L=t.I3DXMatrixMultiply(a,L)}else if(N.KeyD){const a=t.I3DXRotateYMatrix(-.005*e);L=t.I3DXMatrixMultiply(a,L)}if(i.valueAsNumber=L.data[0],s.valueAsNumber=L.data[1],d.valueAsNumber=L.data[2],N.KeyW){const a=t.I3DXMatrixScale(L,.2*e);r.valueAsNumber+=a.data[0],o.valueAsNumber+=a.data[1],n.valueAsNumber+=a.data[2]}else if(N.KeyS){const a=t.I3DXMatrixScale(L,-.2*e);r.valueAsNumber+=a.data[0],o.valueAsNumber+=a.data[1],n.valueAsNumber+=a.data[2]}if(N.KeyQ){const a=t.I3DXVectorUnit(t.I3DXVectorCross(g,L)),i=t.I3DXMatrixScale(a,.2*e/10);r.valueAsNumber+=i.data[0],o.valueAsNumber+=i.data[1],n.valueAsNumber+=i.data[2]}else if(N.KeyE){const a=t.I3DXVectorUnit(t.I3DXVectorCross(g,L)),i=t.I3DXMatrixScale(a,-.2*e/10);r.valueAsNumber+=i.data[0],o.valueAsNumber+=i.data[1],n.valueAsNumber+=i.data[2]}const c=t.I3DXMatrixLookToLH(t.I3DXVector3(r.valueAsNumber,o.valueAsNumber,n.valueAsNumber),t.I3DXVector3(L.data[0],L.data[1],L.data[2]),g),X=t.I3DXMatrixPerspectiveFovLH(t.I3DXToRadian(I.valueAsNumber),640/480,1,100);R.SetTransform(t.I3DTS_VIEW,c),R.SetTransform(t.I3DTS_PROJECTION,X),R.SetTransform(t.I3DTS_WORLD,w);const M=h.valueAsNumber,f=t.I3DXTranslateMatrix(-9,2,M);R.SetTransform(t.I3DTS_WORLD,f),R.DrawPrimitive(t.I3DPT_TRIANGLELIST,_);const T=D.valueAsNumber,x=t.I3DXTranslateMatrix(-9,2,T);R.SetTransform(t.I3DTS_WORLD,x),R.DrawPrimitive(t.I3DPT_TRIANGLELIST,V),R.SetTransform(t.I3DTS_WORLD,t.I3DXMatrixMultiply(t.I3DXRotateXMatrix(P/3),m)),R.DrawPrimitive(t.I3DPT_TRIANGLESTRIP,b);const p=t.I3DXTranslateMatrix(0,0,Math.sin(P/2));R.SetTransform(t.I3DTS_WORLD,p),R.DrawPrimitive(t.I3DPT_TRIANGLESTRIP,u),R.SetTransform(t.I3DTS_WORLD,t.I3DXRotateYMatrix(P/3)),R.MultiplyTransform(t.I3DTS_WORLD,t.I3DXTranslateMatrix(8,0,0)),R.DrawPrimitive(t.I3DPT_TRIANGLEFAN,l),R.EndScene(),R.Present(),P+=.005*e,E&&requestAnimationFrame(B),H+=(a-A-H)/20,A=a}setInterval((()=>{c.innerText=(1e3/H).toFixed(1)+" fps"}),500),window.addEventListener("keydown",(function(t){t.code in N&&(N[t.code]=!0)})),window.addEventListener("keyup",(function(t){return t.code in N?N[t.code]=!1:"Enter"==t.code&&(E=!E,E&&(A=Date.now(),requestAnimationFrame(B))),t.preventDefault(),!1}),!0),R.BeginScene(),R.DrawPrimitive(t.I3DPT_TRIANGLESTRIP,u),R.SetTransform(t.I3DTS_WORLD,t.I3DXScaleMatrix(2,1,2)),R.DrawPrimitive(t.I3DPT_TRIANGLESTRIP,b),R.EndScene(),R.Present()}()})()})();